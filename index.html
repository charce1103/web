<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°é–’å·¥ä½œå®¤</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root {
            --primary-color: #4a90e2;
            --primary-dark: #357abd;
            --accent-color: #ff6b6b;
            --bg-color: #f4f6f9;
            --sidebar-bg: #ffffff;
            --card-bg: #ffffff;
            --text-main: #2c3e50;
            --text-sec: #7f8c8d;
            --radius: 12px;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --header-height: 70px;
            --sidebar-width: 260px;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            padding-bottom: 80px; /* é ç•™æ‰‹æ©Ÿç‰ˆåº•éƒ¨é¸å–®ç©ºé–“ */
        }

        /* --- 1. App Layout (å·¦å³ä½ˆå±€) --- */
        .app-wrapper {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            min-height: 100vh;
        }

        /* --- 2. Sidebar (æ¡Œé¢ç‰ˆå·¦å´é¸å–®) --- */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--sidebar-bg);
            padding: 2rem 1.5rem;
            height: 100vh;
            position: sticky;
            top: 0;
            overflow-y: auto;
            border-right: 1px solid rgba(0,0,0,0.05);
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .app-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 1rem;
            cursor: pointer;
            letter-spacing: 1px;
        }

        .menu-label {
            font-size: 0.85rem;
            text-transform: uppercase;
            color: #999;
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: 0.5px;
        }

        /* æ¨™ç±¤é›²æ¨£å¼ */
        .tag-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .nav-tag {
            padding: 6px 14px;
            background: #f0f4f8;
            color: var(--text-main);
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .nav-tag:hover {
            background: #e1e8ef;
            transform: translateY(-1px);
        }

        .nav-tag.active {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 4px 10px rgba(74, 144, 226, 0.3);
        }

        /* --- 3. Main Content (å³å´å…§å®¹) --- */
        .main-content {
            flex-grow: 1;
            padding: 2rem 3rem;
            width: 100%; /* é˜²æ­¢ Grid æº¢å‡º */
        }

        /* æœå°‹åˆ— */
        .search-bar-wrapper {
            margin-bottom: 2rem;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 15px 20px;
            padding-left: 45px;
            border: none;
            border-radius: 50px;
            background: white;
            box-shadow: var(--shadow-sm);
            font-size: 1rem;
            transition: 0.3s;
        }
        
        .search-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.15);
        }

        .search-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: #bbb;
        }

        /* --- 4. ç½®é ‚é€£çµå€å¡Š (Pinned Section) --- */
        .pinned-section {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 2.5rem;
            box-shadow: var(--shadow-sm);
            border-left: 5px solid var(--accent-color);
            background: linear-gradient(to right, #fff, #fffafb);
        }

        .pinned-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-main);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pinned-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .pinned-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: white;
            border: 1px solid #eee;
            border-radius: 8px;
            text-decoration: none;
            color: var(--text-main);
            transition: all 0.2s;
            font-weight: 500;
        }

        .pinned-item:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .pinned-item::before {
            content: 'ğŸ”—';
            margin-right: 10px;
            font-size: 0.9rem;
        }

        /* --- 5. ä½œå“ Grid å€å¡Š --- */
        .section-header {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--text-main);
            padding-left: 10px;
            border-left: 4px solid var(--primary-color);
        }

        .portfolio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(0,0,0,0.02);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .card-img-link {
            display: block;
            width: 100%;
            height: 180px;
            overflow: hidden;
            background: #eee;
        }

        .card-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .card:hover .card-img { transform: scale(1.08); }

        .card-content {
            padding: 18px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 10px;
        }

        .mini-tag {
            font-size: 0.7rem;
            color: var(--primary-color);
            background: rgba(74, 144, 226, 0.1);
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 500;
        }

        .card-title {
            font-size: 1.15rem;
            font-weight: 700;
            margin: 0 0 8px 0;
            line-height: 1.4;
        }

        .card-title-link {
            color: var(--text-main);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .card-title-link:hover { color: var(--primary-color); }

        .card-desc {
            font-size: 0.9rem;
            color: var(--text-sec);
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* --- 6. Admin Controls --- */
        .admin-overlay {
            display: none;
            position: absolute;
            top: 10px;
            right: 10px;
            gap: 5px;
            z-index: 10;
        }
        
        body.is-admin .admin-overlay { display: flex; }

        .icon-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            font-size: 0.9rem;
        }

        .edit-btn { color: var(--primary-color); }
        .del-btn { color: var(--accent-color); }

        /* Floating Admin Button */
        .fab {
            position: fixed;
            bottom: 90px; /* é¿é–‹åº•éƒ¨é¸å–® */
            right: 20px;
            width: 50px;
            height: 50px;
            background: var(--text-main);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 1000;
            transition: transform 0.3s;
        }
        
        .fab.admin-active { background: var(--primary-color); }

        /* --- 7. Mobile Responsive Design --- */
        @media (max-width: 768px) {
            .app-wrapper {
                flex-direction: column;
            }

            /* æ‰‹æ©Ÿç‰ˆï¼šéš±è—å·¦å´ Sidebarï¼Œæ”¹ç‚ºåº•éƒ¨å›ºå®šé¸å–® */
            .sidebar {
                position: fixed;
                bottom: 0;
                top: auto;
                left: 0;
                width: 100%;
                height: 70px; /* å›ºå®šé«˜åº¦ */
                padding: 10px 15px;
                flex-direction: row;
                align-items: center;
                gap: 10px;
                background: white;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
                z-index: 2000;
                border-right: none;
                border-top: 1px solid #eee;
                overflow-x: auto; /* å…è¨±æ©«å‘æ²å‹• */
                overflow-y: hidden;
                white-space: nowrap;
                -webkit-overflow-scrolling: touch;
            }
            
            /* éš±è— Sidebar ä¸­çš„æ¨™é¡Œå’Œæ–‡å­—æ¨™ç±¤ï¼Œåªç•™ Tag Cloud */
            .sidebar .app-title, .sidebar .menu-label {
                display: none;
            }

            .sidebar .tag-cloud {
                flex-wrap: nowrap; /* ä¸æ›è¡Œï¼Œæ”¹æˆæ©«å‘æ’åˆ— */
                width: 100%;
            }

            .nav-tag {
                flex-shrink: 0; /* é˜²æ­¢æ¨™ç±¤è¢«å£“ç¸® */
                padding: 8px 16px;
                font-size: 0.95rem;
                border: 1px solid #eee;
            }

            /* æ‰‹æ©Ÿç‰ˆä¸»å…§å®¹å€èª¿æ•´ */
            .main-content {
                padding: 1.5rem;
            }
            
            .search-input {
                font-size: 16px; /* é˜²æ­¢ iOS ç¸®æ”¾ */
            }

            .fab {
                bottom: 85px; /* èª¿æ•´ FAB ä½ç½® */
            }
            
            /* æ‰‹æ©Ÿç‰ˆæ¨™é¡Œé¡¯ç¤ºåœ¨ä¸Šæ–¹ */
            .mobile-header {
                display: block;
                text-align: center;
                margin-bottom: 20px;
            }
            
            .mobile-header h1 {
                margin: 0;
                color: var(--primary-color);
                font-size: 1.5rem;
            }
        }
        
        @media (min-width: 769px) {
            .mobile-header { display: none; }
        }

        /* Loading */
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 50px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <div class="app-wrapper">
        
        <nav class="sidebar" id="sidebar-nav">
            <div class="app-title" onclick="location.reload()">å°é–’å·¥ä½œå®¤</div>
            <div>
                <div class="menu-label">åˆ†é¡ç€è¦½</div>
                <div class="tag-cloud" id="tag-cloud-container">
                    </div>
            </div>
        </nav>

        <main class="main-content">
            
            <div class="mobile-header">
                <h1 onclick="location.reload()">å°é–’å·¥ä½œå®¤</h1>
            </div>

            <div class="search-bar-wrapper">
                <span class="search-icon">ğŸ”</span>
                <input type="text" class="search-input" id="search-input" placeholder="æœå°‹ä½œå“åç¨±æˆ–é—œéµå­—...">
            </div>

            <div id="pinned-container" class="pinned-section" style="display: none;">
                <div class="pinned-title">â­ ç²¾é¸é€£çµ / å…¬å‘Š</div>
                <div class="pinned-grid" id="pinned-grid"></div>
            </div>

            <div id="loading" class="loader"></div>

            <div class="section-header">ä½œå“é›†</div>
            <div id="grid" class="portfolio-grid"></div>
        </main>

    </div>

    <div id="admin-fab" class="fab" title="ç®¡ç†å“¡ç™»å…¥">âš™ï¸</div>

    <script>
        // ==========================================
        // è¨­å®šå€åŸŸï¼šè«‹ç¢ºèªæ­¤ç¶²å€æ­£ç¢º
        // ==========================================
        const API_URL = "https://script.google.com/macros/s/AKfycbyjABkbVoHep96Zi777VjUxqFItnLVY1g2eYbJ7rgFIkBpWOAmnCkGGkZzO8nCubo7GvQ/exec"; 
        
        // å…¨åŸŸè®Šæ•¸
        let allData = [];
        let currentFilter = 'all'; // ç›®å‰é¸ä¸­çš„åˆ†é¡
        let isAdmin = false;
        let adminPassword = "";
        
        // è‡ªå‹•ç™»å‡ºè®Šæ•¸
        let logoutTimer;
        const TIMEOUT_DURATION = 20 * 60 * 1000; // 20åˆ†é˜

        // åˆå§‹åŒ–
        window.onload = function() {
            fetchData();
        };

        // é–’ç½®åµæ¸¬
        document.addEventListener('mousemove', resetLogoutTimer);
        document.addEventListener('keydown', resetLogoutTimer);
        document.addEventListener('click', resetLogoutTimer);
        document.addEventListener('touchstart', resetLogoutTimer);

        function resetLogoutTimer() {
            if (isAdmin) {
                clearTimeout(logoutTimer);
                logoutTimer = setTimeout(performLogout, TIMEOUT_DURATION);
            }
        }

        function performLogout() {
            if (isAdmin) {
                isAdmin = false;
                adminPassword = "";
                document.body.classList.remove('is-admin');
                const fab = document.getElementById('admin-fab');
                fab.textContent = 'âš™ï¸';
                fab.classList.remove('admin-active');
                Swal.fire({
                    icon: 'info',
                    title: 'é–’ç½®éä¹…',
                    text: 'ç‚ºäº†å®‰å…¨èµ·è¦‹ï¼Œç³»çµ±å·²è‡ªå‹•å°‡æ‚¨ç™»å‡ºç®¡ç†æ¨¡å¼ã€‚',
                    timer: 3000,
                    showConfirmButton: false,
                    toast: true,
                    position: 'top-end'
                });
            }
        }

        // 1. è®€å–è³‡æ–™
        async function fetchData() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error("ç¶²è·¯é€£ç·šç•°å¸¸");
                const data = await response.json();
                processData(data);
            } catch (error) {
                console.error("è¼‰å…¥å¤±æ•—:", error);
                document.getElementById('loading').innerHTML = '<p style="text-align:center; color:red;">ç„¡æ³•è¼‰å…¥è³‡æ–™ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚</p>';
            }
        }

        // 2. è³‡æ–™è™•ç† (åˆ†é›¢ç½®é ‚èˆ‡ä¸€èˆ¬)
        function processData(data) {
            allData = data;
            const loader = document.getElementById('loading');
            loader.style.display = 'none';

            renderSidebar(data);
            filterAndRender();
        }

        // 3. æ¸²æŸ“å´é‚Šæ¬„/åº•éƒ¨é¸å–® (æ¨™ç±¤é›²)
        function renderSidebar(data) {
            const tagContainer = document.getElementById('tag-cloud-container');
            const splitRegex = /[|,\uff0c\u3001]/;
            
            // æå–æ‰€æœ‰æ¨™ç±¤
            const allTags = [...new Set(
                data.flatMap(item => String(item.category).split(splitRegex).map(tag => tag.trim()))
            )].filter(tag => tag !== "").sort();

            let html = `<div class="nav-tag active" onclick="setFilter('all', this)">å…¨éƒ¨</div>`;
            allTags.forEach(tag => {
                html += `<div class="nav-tag" onclick="setFilter('${tag}', this)">${tag}</div>`;
            });
            tagContainer.innerHTML = html;
        }

        // åˆ‡æ›åˆ†é¡
        function setFilter(tag, element) {
            currentFilter = tag;
            
            // æ›´æ–° UI ç‹€æ…‹
            document.querySelectorAll('.nav-tag').forEach(el => el.classList.remove('active'));
            if(element) element.classList.add('active');

            // å¦‚æœæ˜¯æ‰‹æ©Ÿç‰ˆï¼Œé»æ“Šå¾Œè‡ªå‹•æ»¾å‹•è®“è¢«é»çš„æ¨™ç±¤ç½®ä¸­ (Optional)
            if(window.innerWidth <= 768 && element) {
                element.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
            }

            filterAndRender();
        }

        // 4. æ ¸å¿ƒæ¸²æŸ“é‚è¼¯ (ç½®é ‚ + ä¸€èˆ¬)
        function filterAndRender() {
            const search = document.getElementById('search-input').value.toLowerCase();
            const splitRegex = /[|,\uff0c\u3001]/;

            // æ­¥é©Ÿ A: ç¯©é¸ç¬¦åˆæ¢ä»¶çš„è³‡æ–™
            const filtered = allData.filter(item => {
                const matchSearch = String(item.title).toLowerCase().includes(search) || 
                                    String(item.description).toLowerCase().includes(search);
                
                const itemTags = String(item.category).split(splitRegex).map(t => t.trim());
                const matchCat = currentFilter === 'all' || itemTags.includes(currentFilter);
                
                return matchSearch && matchCat;
            });

            // æ­¥é©Ÿ B: åˆ†é›¢ã€Œç½®é ‚ (IDé–‹é ­a)ã€èˆ‡ã€Œä¸€èˆ¬ã€
            // æ³¨æ„ï¼šç½®é ‚é …ç›®ä¹Ÿè¦å—æœå°‹å’Œåˆ†é¡å½±éŸ¿ï¼Œå¦‚æœä½ å¸Œæœ›ç½®é ‚æ°¸é é¡¯ç¤ºï¼Œè«‹èª¿æ•´é€™è£¡
            const pinnedItems = filtered.filter(d => String(d.id).toLowerCase().startsWith('a'));
            const normalItems = filtered.filter(d => !String(d.id).toLowerCase().startsWith('a'));

            // æ¸²æŸ“ç½®é ‚å€å¡Š
            renderPinned(pinnedItems);
            // æ¸²æŸ“ä¸€èˆ¬ Grid
            renderGrid(normalItems);
        }

        function renderPinned(items) {
            const container = document.getElementById('pinned-container');
            const grid = document.getElementById('pinned-grid');
            
            if (items.length === 0) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';
            grid.innerHTML = items.map(item => `
                <a href="${item.link}" target="_blank" class="pinned-item">
                    ${item.title}
                    ${isAdmin ? `<span onclick="event.preventDefault(); editItem('${item.id}')" style="margin-left:auto; font-size:0.8rem; cursor:pointer;">âœï¸</span>` : ''}
                </a>
            `).join('');
        }

        function renderGrid(items) {
            const grid = document.getElementById('grid');
            const splitRegex = /[|,\uff0c\u3001]/;
            grid.innerHTML = '';

            if (items.length === 0) {
                grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #999;">æ²’æœ‰ç›¸é—œå…§å®¹ã€‚</p>';
                return;
            }

            items.forEach(item => {
                // æ¨™ç±¤ HTML
                const tagsHtml = String(item.category).split(splitRegex)
                    .map(tag => tag.trim())
                    .filter(tag => tag !== "")
                    .map(tag => `<span class="mini-tag">${tag}</span>`)
                    .join('');

                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <a href="${item.link}" target="_blank" class="card-img-link">
                        <img src="${item.image}" alt="${item.title}" class="card-img" onerror="this.src='images/image001.jpg'">
                    </a>
                    <div class="card-content">
                        <div class="card-tags">${tagsHtml}</div>
                        <h3 class="card-title">
                            <a href="${item.link}" target="_blank" class="card-title-link">${item.title}</a>
                        </h3>
                        <p class="card-desc">${item.description}</p>
                    </div>
                    <div class="admin-overlay">
                        <button class="icon-btn edit-btn" onclick="editItem('${item.id}')">âœï¸</button>
                        <button class="icon-btn del-btn" onclick="deleteItem('${item.id}')">ğŸ—‘ï¸</button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // 5. ç›£è½æœå°‹è¼¸å…¥
        document.getElementById('search-input').addEventListener('input', filterAndRender);

        // 6. API èˆ‡ Admin é‚è¼¯ (ä¿æŒä¸è®Š)
        async function sendToAPI(action, payload = {}, id = null) {
            const body = JSON.stringify({
                action: action,
                password: adminPassword,
                data: payload,
                id: id
            });

            const response = await fetch(API_URL, {
                method: 'POST',
                body: body,
                headers: { "Content-Type": "text/plain;charset=utf-8" }
            });
            
            const result = await response.json();
            if (result.status === 'error') throw new Error(result.message);
            return result.message;
        }

        const fab = document.getElementById('admin-fab');
        fab.addEventListener('click', async () => {
            if (!isAdmin) {
                const { value: password } = await Swal.fire({
                    title: 'ç®¡ç†å“¡ç™»å…¥',
                    input: 'password',
                    inputAttributes: {
                        autocapitalize: 'off',
                        autocorrect: 'off',
                        autocomplete: 'current-password' 
                    },
                    showCancelButton: true,
                    confirmButtonText: 'ç™»å…¥'
                });

                if (password) {
                    adminPassword = password;
                    isAdmin = true;
                    document.body.classList.add('is-admin');
                    fab.textContent = '+'; 
                    fab.classList.add('admin-active');
                    resetLogoutTimer();
                    filterAndRender(); // é‡æ–°æ¸²æŸ“ä»¥é¡¯ç¤ºç·¨è¼¯æŒ‰éˆ•
                    Swal.fire({ icon: 'success', title: 'ç®¡ç†æ¨¡å¼å•Ÿç”¨', toast: true, position: 'top-end', showConfirmButton: false, timer: 2000 });
                }
            } else {
                showForm();
            }
        });

        async function showForm(item = null) {
            resetLogoutTimer();
            const isEdit = !!item;
            const { value: formValues } = await Swal.fire({
                title: isEdit ? 'ç·¨è¼¯ä½œå“' : 'æ–°å¢ä½œå“',
                html:
                    `<input id="swal-title" class="swal2-input" placeholder="ä½œå“åç¨±" value="${item ? item.title : ''}">` +
                    `<input id="swal-cat" class="swal2-input" placeholder="åˆ†é¡ (ä¾‹å¦‚: ç¶²é  | è¨­è¨ˆ)" value="${item ? item.category : ''}">` +
                    `<input id="swal-desc" class="swal2-input" placeholder="ä½œå“æè¿°" value="${item ? item.description : ''}">` +
                    `<input id="swal-img" class="swal2-input" placeholder="åœ–ç‰‡é€£çµ URL" value="${item ? item.image : ''}">` +
                    `<input id="swal-link" class="swal2-input" placeholder="ä½œå“é€£çµ URL" value="${item ? item.link : ''}">`,
                focusConfirm: false,
                showCancelButton: true,
                preConfirm: () => {
                    return {
                        id: item ? item.id : null,
                        title: document.getElementById('swal-title').value,
                        category: document.getElementById('swal-cat').value,
                        description: document.getElementById('swal-desc').value,
                        image: document.getElementById('swal-img').value,
                        link: document.getElementById('swal-link').value
                    }
                }
            });

            if (formValues) {
                Swal.fire({ title: 'è™•ç†ä¸­...', didOpen: () => Swal.showLoading() });
                try {
                    const action = isEdit ? 'update' : 'add';
                    const msg = await sendToAPI(action, formValues);
                    Swal.fire('æˆåŠŸ', msg, 'success');
                    fetchData(); 
                    resetLogoutTimer();
                } catch (err) {
                    Swal.fire('éŒ¯èª¤', err.message, 'error');
                }
            }
        }

        function editItem(id) {
            resetLogoutTimer();
            const item = allData.find(d => String(d.id) === String(id));
            if (item) showForm(item);
        }

        function deleteItem(id) {
            resetLogoutTimer();
            Swal.fire({
                title: 'ç¢ºå®šåˆªé™¤?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                confirmButtonText: 'åˆªé™¤'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    Swal.fire({ title: 'åˆªé™¤ä¸­...', didOpen: () => Swal.showLoading() });
                    try {
                        const msg = await sendToAPI('delete', {}, id);
                        Swal.fire('æˆåŠŸ', msg, 'success');
                        fetchData();
                        resetLogoutTimer();
                    } catch (err) {
                        Swal.fire('éŒ¯èª¤', err.message, 'error');
                    }
                }
            });
        }
    </script>
</body>
</html>